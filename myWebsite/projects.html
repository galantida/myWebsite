<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, inital-scale=1.0" />
    <title>Code Studio</title>
    <script src="javascript/utils.js"></script>
    <script src="javascript/XHRRequestManager.js"></script>
    <script src="javascript/Templates.js"></script>
    <script src="javascript/Template.js"></script>
    <script src="javascript/Project.js"></script>
    <script src="javascript/Projects.js"></script>
    <link rel="stylesheet" href="styles.css">
    <script>
        const queryString = window.location.search;
        const params = new URLSearchParams(queryString);

        var templates = new Templates();
        var projects = new Projects();

        function loadPage() {
            loadTemplates();
        }

        function loadTemplates() {
            var templateList = ["templates/header.html", "templates/footer.html", "templates/projectBanner.html"];
            templates.loadTemplates(templateList, loadContent);
        }

        function loadContent() {

            // download content
            projects.loadProjectsByIndexFile("content/index.json", displayPage);
        }

        function displayPage() {

            // display contentless templates
            document.getElementById("header").innerHTML = templates.getTemplate("header").template;
            document.getElementById("footer").innerHTML = templates.getTemplate("footer").template;

            // content section
            var template = templates.getTemplate("projectBanner");

            // get content
            var filteredProjects = projects.search(params.get("searchString"));
            
            // display content
            var html = "";
            for (var t = 0; t < filteredProjects.length; t++) {
                var content = projects.projects[t].content;
                html += template.populated(content);
            }
            document.getElementById("content").innerHTML = html;
            document.body.style.visibility = "visible";
        }
    </script>
</head>
<body style="visibility:hidden;">
    <div class="siteContainer">
        <div id="header"></div>

        <div id="content"></div>

        <div id="footer"></div>
    </div>
</body>
</html>
<script>
    loadPage();
</script>